output {
  if "metric" in [tags] {
    stdout {
      codec => line {
        format => "1m rate: %{documents.rate_1m} ( %{documents.count} )"
      }
    }
  }
}
{% if logstash_base_outputs is defined %}
{%   for item in logstash_base_outputs %}
output {
  {{ item['output'] }} {
{%     if item.output == "elasticsearch" %}
    hosts => ["{{ item['output_host'] }}"]
{%     endif %}
{%     if item.output == "redis" %}
    host => "{{ item['output_host'] }}"
    data_type => "list"
    key => "logstash"
{%     endif %}
{%     if item.output == "rabbitmq" %}
    host => "{{ item['output_host'] }}"
    exchange => "{{ item['exchange'] }}"
    exchange_type => "{{ item['exchange_type'] }}"
{%       if item['user'] is defined %}
    user => "{{ item['user'] }}"
{%       endif %}
{%       if item['password'] is defined %}
    password => "{{ item['password'] }}"
{%       endif %}
{%     endif %}
  }
}
{%   endfor %}
{% endif %}

{% if logstash_custom_outputs is defined %}
{%   for item in logstash_custom_outputs %}

output {
  {% if item.if_condition is defined %}
  if {{ item.if_condition }} {
  {% endif %}

  {{ item['output'] }} {
  {% for line in item.lines %}
      {{ line }}
  {% endfor %}
  }

  {% if item.if_condition is defined %}
  }
  {% endif %}
}

{%   endfor %}
{% endif %}
