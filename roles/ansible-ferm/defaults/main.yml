---
# defaults file for ansible-ferm
ferm_clear_firewall: false  #defines if all rules should be cleared and reset
ferm_custom_chains:
  - chain: ALLOWED-LOGGING
  - chain: ALLOWED-NO-LOGGING
ferm_enable_ip_forwarding: false
ferm_nat_filters:
  - chain: INPUT
    policy: ACCEPT
    rules: []
  - chain: OUTPUT
    policy: ACCEPT
    rules: []
  - chain: POSTROUTING
    policy: ACCEPT
    rules:
      - name: masquerade
        proto: any
        out_interface: '{{ ansible_default_ipv4.interface }}'
        jump: MASQUERADE
        weight: '500'
  - chain: PREROUTING
    policy: ACCEPT
    rules:
      - name: transparent_squid
        proto: tcp
        dport: 80
        redirect_to: 3128
        weight: '500'
ferm_table_filters:
  - chain: ALLOWED-LOGGING
    logging: true
    logging_prefix: IPTables-Allowed
    rules:
      - name: allow_any_any
        proto: any
        dport: any
        target: ACCEPT
        weight: '500'
  - chain: FORWARD
    policy: DROP
    connection_tracking:
      - state: INVALID
        policy: DROP
      - state: ESTABLISHED
        policy: ACCEPT
      - state: RELATED
        policy: ACCEPT
    rules: []
  - chain: INPUT  #define rules to be applied in-bound...name's should be unique (files generated by weight/name)
    policy: DROP
    allow_local_connections: true  #defines if local loopback connections should be allowed.
    connection_tracking:
      - state: INVALID
        policy: DROP
      - state: ESTABLISHED
        policy: ACCEPT
      - state: RELATED
        policy: ACCEPT
    rules:
      - name: allow_http_in
        proto: tcp
        dport: 80
        target: ACCEPT
        jump: ALLOWED-LOGGING
        weight: '500'
      - name: allow_https_in
        proto: tcp
        dport: 443
        target: ACCEPT
        jump: ALLOWED-LOGGING
        weight: '500'
      - name: allow_ipsec_in
        proto: udp
        dport: 500
        target: ACCEPT
        weight: '500'
      - name: allow_ipsec_in
        proto: esp
        target: ACCEPT
        weight: '500'
      - name: allow_ipsec_in
        proto: ah
        target: ACCEPT
        weight: '500'
      - name: allow_ping_in
        proto: icmp
        source: 0.0.0.0/0
        destination: 0.0.0.0/0
        target: ACCEPT
        weight: '500'  #defines the default rule weight for rules that do not specify it. (000=highest,999=lowest)
      - name: allow_ssh_in
        proto: tcp
        source: 0.0.0.0/0
        destination: 0.0.0.0/0
        dport: 22
        target: ACCEPT
        jump: ALLOWED-LOGGING  #defines a jump rule to set as target...defined in ferm_custom_chains
        weight: '500'
  - chain: OUTPUT
    policy: ACCEPT
    connection_tracking:
      - state: INVALID
        policy: DROP
      - state: ESTABLISHED
        policy: ACCEPT
      - state: RELATED
        policy: ACCEPT
    rules: []
